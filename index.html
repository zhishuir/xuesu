<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>é›ªç¦¾åœ£è¯å¿«ä¹â¤ï¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: linear-gradient(to bottom, #0a0e27 0%, #1a1a2e 50%, #2d1b3d 100%);
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            touch-action: none;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* æ–‡å­—å®¹å™¨ - å›ºå®šåœ¨åº•éƒ¨ */
        .message-container {
            position: fixed;
            bottom: 80px;
            left: 0;
            width: 100%;
            z-index: 5;
            pointer-events: none;
            padding: 0 20px;
            box-sizing: border-box;
        }

        /* å•è¡Œæ–‡å­—æ ·å¼ */
        .message-line {
            color: rgba(255, 255, 255, 0.7); /* é€‚å½“æé«˜å¯è¯»æ€§ */
            font-size: clamp(13px, 3.5vw, 16px);
            text-align: center;
            margin-bottom: 8px;
            text-shadow: 0 0 6px rgba(255, 182, 193, 0.4),
                         0 0 12px rgba(255, 182, 193, 0.2);
            letter-spacing: 0.5px;
            line-height: 1.3;
            animation: subtleGlow 4s ease-in-out infinite alternate;
            white-space: nowrap;
            overflow: hidden;
            opacity: 0.9;
            transition: opacity 0.8s ease;
        }

        /* ä¸‰è¡Œæ–‡å­—å¤§å°ç•¥æœ‰ä¸åŒï¼Œå¢å¼ºå±‚æ¬¡æ„Ÿ */
        .message-line:nth-child(1) {
            font-size: clamp(14px, 4vw, 17px);
        }
        
        .message-line:nth-child(2) {
            font-size: clamp(13px, 3.5vw, 16px);
            animation-delay: 1.5s;
        }
        
        .message-line:nth-child(3) {
            font-size: clamp(12px, 3vw, 15px);
            animation-delay: 3s;
        }

        @keyframes subtleGlow {
            0%, 100% {
                text-shadow: 0 0 6px rgba(255, 182, 193, 0.4),
                             0 0 12px rgba(255, 182, 193, 0.2);
            }
            50% {
                text-shadow: 0 0 10px rgba(255, 182, 193, 0.5),
                             0 0 18px rgba(255, 182, 193, 0.3);
            }
        }

        /* æ·¡å…¥æ·¡å‡ºæ•ˆæœ */
        @keyframes fadeInOut {
            0%, 20% { opacity: 0.9; }
            80%, 100% { opacity: 0.1; }
        }

        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 182, 193, 0.15);
            border: 2px solid rgba(255, 182, 193, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 182, 193, 0.2);
        }

        .music-control:hover {
            background: rgba(255, 182, 193, 0.25);
            transform: scale(1.1);
        }

        .music-control i {
            color: rgba(255, 255, 255, 0.9);
            font-size: 22px;
            filter: drop-shadow(0 0 3px rgba(255, 182, 193, 0.5));
        }

        .music-info {
            position: fixed;
            top: 80px;
            right: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-align: right;
            z-index: 100;
            background: rgba(0, 0, 0, 0.2);
            padding: 5px 10px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            opacity: 0.8;
        }

        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: clamp(12px, 2.5vw, 14px);
            text-align: center;
            z-index: 10;
            pointer-events: none;
            padding: 0 20px;
            width: 100%;
            max-width: 400px;
        }

        @media (max-width: 768px) {
            .message-container {
                bottom: 70px;
                padding: 0 15px;
            }
            
            .message-line {
                font-size: 14px;
                margin-bottom: 6px;
            }
            
            .message-line:nth-child(1) {
                font-size: 15px;
            }
            
            .message-line:nth-child(2) {
                font-size: 14px;
            }
            
            .message-line:nth-child(3) {
                font-size: 13px;
            }
            
            .music-control {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
            }
            
            .music-control i {
                font-size: 20px;
            }
            
            .music-info {
                top: 70px;
                right: 15px;
                font-size: 11px;
            }
        }

        @media (max-width: 480px) {
            .message-container {
                bottom: 60px;
            }
            
            .message-line {
                font-size: 12px;
                margin-bottom: 5px;
            }
            
            .message-line:nth-child(1) {
                font-size: 13px;
            }
            
            .message-line:nth-child(2) {
                font-size: 12px;
            }
            
            .message-line:nth-child(3) {
                font-size: 11px;
            }
            
            .instructions {
                font-size: 11px;
                bottom: 15px;
            }
        }

        @media (max-height: 600px) {
            .message-container {
                bottom: 50px;
            }
            
            .message-line {
                font-size: 11px;
                margin-bottom: 4px;
            }
            
            .message-line:nth-child(1) {
                font-size: 12px;
            }
            
            .message-line:nth-child(2) {
                font-size: 11px;
            }
            
            .message-line:nth-child(3) {
                font-size: 10px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- æ¶ˆæ¯å®¹å™¨ - å›ºå®šåœ¨åº•éƒ¨ -->
    <div class="message-container" id="messageContainer">
        <div class="message-line" id="line1">é›ªç¦¾åœ£è¯å¿«ä¹ğŸ¥° </div>
        <div class="message-line" id="line2">åœ£è¯æ ‘ä¸Šçš„æ˜Ÿæ˜Ÿä¸€é—ªä¸€é—ªçš„â­ ä½ ä¹Ÿåƒæ˜Ÿæ˜Ÿä¸€é—ªä¸€é—ªçš„ğŸŒ </div>
        <div class="message-line" id="line3">åœ£è¯å®‰åº·ğŸâ€¢ á´¥ â€¢ğŸ„æš–æ„å¸¸åœ¨</div>
    </div>
    
    <div class="music-control" id="musicControl">
        <i class="fas fa-volume-up"></i>
    </div>
    <div class="music-info" id="musicInfo">åŠ è½½éŸ³ä¹ä¸­...</div>
    
    <canvas id="canvas"></canvas>
    <div class="instructions">ğŸ’ æ‹–åŠ¨/æ»‘åŠ¨æ—‹è½¬åœ£è¯æ ‘ | åŒæŒ‡ç¼©æ”¾</div>
    
    <!-- éŸ³ä¹å…ƒç´  -->
    <audio id="bgMusic" loop preload="auto">
        <!-- è¿™é‡Œæ›¿æ¢æˆä½ çš„éŸ³ä¹æ–‡ä»¶è·¯å¾„ -->
        <source src="1.mp3" type="audio/mpeg">
        <source src="1.ogg" type="audio/ogg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const bgMusic = document.getElementById('bgMusic');
        const musicControl = document.getElementById('musicControl');
        const musicInfo = document.getElementById('musicInfo');
        const line1 = document.getElementById('line1');
        const line2 = document.getElementById('line2');
        const line3 = document.getElementById('line3');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // å®šä¹‰æ‰€æœ‰ç¥ç¦è¯­ï¼ˆåˆ†ä¸ºä¸‰è¡Œä¸€ç»„ï¼‰
        const messageGroups = [
            [
                "é›ªç¦¾åœ£è¯å¿«ä¹ğŸ¥°",
                "åœ£è¯æ ‘ä¸Šçš„æ˜Ÿæ˜Ÿä¸€é—ªä¸€é—ªçš„â­ ä½ ä¹Ÿåƒæ˜Ÿæ˜Ÿä¸€é—ªä¸€é—ªçš„ğŸŒ ",
                "åœ£è¯å®‰åº·ğŸâ€¢ á´¥ â€¢ğŸ„æš–æ„å¸¸åœ¨"
            ],
            [
                "åœ£è¯å…‰æ™¯ğ–¤ğŸ¦Œâ™¡â­ï¸â‹†á´—Ìˆ ğŸ…ğŸ»çˆ±ä¸æ¬¢æ­Œ",
                "ğŸæ„¿ä½ åœ£è¯,æ˜äº®æ¬¢å–œğŸŠ",
                "æ„¿æ¯ä¸ªåœ£è¯éƒ½æœ‰ä½ é™ªä¼´ â¤ï¸"
            ],
            [
                "é›ªèŠ±é£˜è½ï¼Œä¸åŠä½ æ¸©æŸ”çš„ä¸‡åˆ†ä¹‹ä¸€ â„ï¸",
                "åœ£è¯é“ƒå£°å“èµ·ï¼Œéƒ½æ˜¯æˆ‘å¯¹ä½ çš„æ€å¿µ ğŸ””",
                "Merry Christmasï¼Œæˆ‘çš„é›ªç¦¾ ğŸ„"
            ]
        ];

        let currentGroupIndex = 0;
        
        // æ›´æ–°æ¶ˆæ¯è¡Œ
        function updateMessages() {
            const group = messageGroups[currentGroupIndex];
            line1.textContent = group[0];
            line2.textContent = group[1];
            line3.textContent = group[2];
            
            // æ·»åŠ æ·¡å…¥æ•ˆæœ
            line1.style.opacity = '0.9';
            line2.style.opacity = '0.9';
            line3.style.opacity = '0.9';
            
            // æ·¡å‡ºæ•ˆæœ
            setTimeout(() => {
                line1.style.opacity = '0.2';
                line2.style.opacity = '0.2';
                line3.style.opacity = '0.2';
            }, 4500); // åœ¨åˆ‡æ¢å‰500mså¼€å§‹æ·¡å‡º
            
            currentGroupIndex = (currentGroupIndex + 1) % messageGroups.length;
        }

        // æ¯5ç§’æ›´æ¢ä¸€æ¬¡æ¶ˆæ¯ç»„
        setInterval(updateMessages, 5000);

        // éŸ³ä¹æ§åˆ¶
        let isMusicPlaying = false;
        let audioContextStarted = false;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–éŸ³ä¹
        window.addEventListener('DOMContentLoaded', () => {
            // è®¾ç½®éŸ³ä¹éŸ³é‡
            bgMusic.volume = 0.3;
            
            // åˆå§‹æ˜¾ç¤ºæ¶ˆæ¯
            updateMessages();
            
            // ç›‘å¬é¡µé¢ç‚¹å‡»äº‹ä»¶æ¥è§£é”éŸ³é¢‘
            document.addEventListener('click', unlockAudio, { once: true });
            document.addEventListener('touchstart', unlockAudio, { once: true });
            
            // éŸ³ä¹æ§åˆ¶æŒ‰é’®ä¹Ÿå¯ä»¥è§£é”éŸ³é¢‘
            musicControl.addEventListener('click', unlockAudio, { once: true });
            
            // è®¾ç½®éŸ³ä¹ä¿¡æ¯
            musicInfo.textContent = "ç‚¹å‡»é¡µé¢æ’­æ”¾éŸ³ä¹ ğŸµ";
        });

        // è§£é”éŸ³é¢‘å¹¶å°è¯•æ’­æ”¾
        function unlockAudio() {
            if (!audioContextStarted) {
                audioContextStarted = true;
                
                // å°è¯•æ’­æ”¾éŸ³ä¹
                const playPromise = bgMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isMusicPlaying = true;
                        musicInfo.textContent = "éŸ³ä¹æ’­æ”¾ä¸­ ğŸ¶";
                        musicControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                        console.log("éŸ³ä¹æ’­æ”¾æˆåŠŸ");
                    }).catch(error => {
                        console.log("æ’­æ”¾å¤±è´¥:", error);
                        musicInfo.textContent = "ç‚¹å‡»æŒ‰é’®æ’­æ”¾éŸ³ä¹ ğŸµ";
                        
                        // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œç‚¹å‡»éŸ³ä¹æ§åˆ¶æŒ‰é’®å¯ä»¥æ’­æ”¾
                        musicControl.addEventListener('click', () => {
                            bgMusic.play().then(() => {
                                isMusicPlaying = true;
                                musicInfo.textContent = "éŸ³ä¹æ’­æ”¾ä¸­ ğŸ¶";
                                musicControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                            });
                        }, { once: true });
                    });
                }
            }
        }

        // éŸ³ä¹æ§åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        musicControl.addEventListener('click', (e) => {
            e.stopPropagation();
            
            if (!audioContextStarted) {
                unlockAudio();
                return;
            }
            
            if (isMusicPlaying) {
                bgMusic.pause();
                isMusicPlaying = false;
                musicInfo.textContent = "éŸ³ä¹å·²æš‚åœ â¸ï¸";
                musicControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else {
                bgMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicInfo.textContent = "éŸ³ä¹æ’­æ”¾ä¸­ ğŸ¶";
                    musicControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                }).catch(error => {
                    console.log("æ’­æ”¾å¤±è´¥:", error);
                    musicInfo.textContent = "æ’­æ”¾å¤±è´¥ ğŸ˜¢";
                });
            }
        });

        // éŸ³ä¹ç›¸å…³äº‹ä»¶ç›‘å¬
        bgMusic.addEventListener('ended', () => {
            // å¾ªç¯æ’­æ”¾
            bgMusic.currentTime = 0;
            bgMusic.play();
        });

        bgMusic.addEventListener('error', (e) => {
            console.error("éŸ³ä¹åŠ è½½é”™è¯¯:", e);
            musicInfo.textContent = "éŸ³ä¹åŠ è½½å¤±è´¥ ğŸ˜¢";
            musicControl.style.opacity = '0.5';
        });

        bgMusic.addEventListener('canplaythrough', () => {
            console.log("éŸ³ä¹å·²åŠ è½½å®Œæˆ");
        });

        // ç›‘å¬éŸ³é‡å˜åŒ–
        bgMusic.addEventListener('volumechange', () => {
            if (bgMusic.volume < 0.1) {
                musicControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else if (bgMusic.volume < 0.5) {
                musicControl.innerHTML = '<i class="fas fa-volume-down"></i>';
            } else {
                musicControl.innerHTML = '<i class="fas fa-volume-up"></i>';
            }
        });

        // ç²’å­ç³»ç»Ÿ
        class Particle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height - canvas.height;
                this.z = Math.random() * 1000;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = Math.random() * 1 + 0.5;
                this.size = Math.random() * 3 + 1;
                this.opacity = Math.random() * 0.5 + 0.4;
                this.color = this.getRandomColor();
                this.twinkle = Math.random() * Math.PI * 2;
            }

            getRandomColor() {
                const colors = [
                    'rgba(255, 182, 193, ',  // ç²‰è‰²
                    'rgba(255, 255, 255, ',  // ç™½è‰²
                    'rgba(255, 192, 203, ',  // æµ…ç²‰
                    'rgba(255, 228, 225, ',  // æ·¡ç²‰
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.twinkle += 0.05;

                if (this.y > canvas.height) {
                    this.reset();
                }
                if (this.x < 0 || this.x > canvas.width) {
                    this.vx *= -1;
                }
            }

            draw() {
                const scale = 1000 / (1000 + this.z);
                const x2d = this.x * scale + canvas.width / 2 * (1 - scale);
                const y2d = this.y * scale + canvas.height / 2 * (1 - scale);
                const size2d = this.size * scale;
                const twinkleOpacity = this.opacity * (0.5 + Math.sin(this.twinkle) * 0.5);

                ctx.beginPath();
                ctx.arc(x2d, y2d, size2d, 0, Math.PI * 2);
                ctx.fillStyle = this.color + twinkleOpacity + ')';
                ctx.fill();

                // å…‰æ™•
                ctx.beginPath();
                ctx.arc(x2d, y2d, size2d * 2.5, 0, Math.PI * 2);
                ctx.fillStyle = this.color + (twinkleOpacity * 0.3) + ')';
                ctx.fill();
            }
        }

        // 3Dåœ£è¯æ ‘
        class ChristmasTree {
            constructor() {
                this.points = [];
                this.rotation = { x: 0.3, y: 0 };
                this.targetRotation = { x: 0.3, y: 0 };
                this.scale = Math.min(window.innerWidth, window.innerHeight) * 0.35;
                this.createTree();
            }

            createTree() {
                // æ ‘çš„ä¸»ä½“ - ç²‰ç™½è‰²ç³»
                const layers = 14;
                for (let i = 0; i < layers; i++) {
                    const y = (i - layers / 2) * 0.28;
                    const radius = (layers - i) * 0.16;
                    const points = 25;
                    
                    for (let j = 0; j < points; j++) {
                        const angle = (j / points) * Math.PI * 2;
                        const r = radius * (0.75 + Math.random() * 0.45);
                        const x = Math.cos(angle) * r;
                        const z = Math.sin(angle) * r;
                        
                        this.points.push({
                            x, y, z,
                            color: this.getTreeColor(),
                            size: Math.random() * 3 + 2
                        });
                    }
                }

                // æ ‘å¹² - ç™½è‰²ç³»
                for (let i = 0; i < 35; i++) {
                    const y = layers / 2 * 0.28 + Math.random() * 0.5;
                    const angle = Math.random() * Math.PI * 2;
                    const r = 0.15;
                    const x = Math.cos(angle) * r;
                    const z = Math.sin(angle) * r;
                    
                    this.points.push({
                        x, y, z,
                        color: 'rgba(245, 245, 245, 0.95)',
                        size: 3
                    });
                }

                // è£…é¥°å½©çƒ - ç²‰ç™½è‰²ç³»
                for (let i = 0; i < 60; i++) {
                    const layer = Math.floor(Math.random() * (layers - 2)) + 1;
                    const y = (layer - layers / 2) * 0.28;
                    const radius = (layers - layer) * 0.16;
                    const angle = Math.random() * Math.PI * 2;
                    const r = radius * (0.5 + Math.random() * 0.4);
                    const x = Math.cos(angle) * r;
                    const z = Math.sin(angle) * r;
                    
                    this.points.push({
                        x, y, z,
                        color: this.getOrnamentColor(),
                        size: Math.random() * 8 + 5,
                        glow: true
                    });
                }

                // é¡¶éƒ¨æ˜Ÿæ˜Ÿ
                this.createStar(-layers / 2 * 0.28 - 0.35);
            }

            createStar(y) {
                const starPoints = 5;
                const outerRadius = 0.35;
                const innerRadius = 0.17;
                
                for (let i = 0; i < starPoints * 2; i++) {
                    const angle = (i / (starPoints * 2)) * Math.PI * 2 - Math.PI / 2;
                    const r = i % 2 === 0 ? outerRadius : innerRadius;
                    const x = Math.cos(angle) * r;
                    const z = Math.sin(angle) * r;
                    
                    for (let j = 0; j < 3; j++) {
                        this.points.push({
                            x, 
                            y: y + (Math.random() - 0.5) * 0.05, 
                            z,
                            color: 'rgba(255, 192, 203, 1)',
                            size: 7,
                            glow: true
                        });
                    }
                }
            }

            getTreeColor() {
                const colors = [
                    'rgba(255, 255, 255, 0.95)',     // çº¯ç™½
                    'rgba(255, 228, 225, 0.95)',     // æ·¡ç²‰ç™½
                    'rgba(255, 240, 245, 0.95)',     // è–°è¡£è‰ç™½
                    'rgba(255, 250, 250, 0.95)',     // é›ªç™½
                    'rgba(255, 182, 193, 0.85)',     // æµ…ç²‰
                    'rgba(255, 192, 203, 0.85)',     // ç²‰è‰²
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            getOrnamentColor() {
                const colors = [
                    'rgba(255, 182, 193, 1)',        // æµ…ç²‰
                    'rgba(255, 192, 203, 1)',        // ç²‰è‰²
                    'rgba(255, 105, 180, 1)',        // çƒ­ç²‰
                    'rgba(255, 255, 255, 1)',        // ç™½è‰²
                    'rgba(255, 228, 225, 1)',        // æ·¡ç²‰
                    'rgba(255, 240, 245, 1)',        // è–°è¡£è‰ç™½
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            rotateX(point, angle) {
                const cos = Math.cos(angle);
                const sin = Math.sin(angle);
                return {
                    x: point.x,
                    y: point.y * cos - point.z * sin,
                    z: point.y * sin + point.z * cos
                };
            }

            rotateY(point, angle) {
                const cos = Math.cos(angle);
                const sin = Math.sin(angle);
                return {
                    x: point.x * cos + point.z * sin,
                    y: point.y,
                    z: -point.x * sin + point.z * cos
                };
            }

            project(point) {
                const scale = 500 / (500 + point.z * this.scale);
                return {
                    x: point.x * this.scale * scale + canvas.width / 2,
                    y: point.y * this.scale * scale + canvas.height / 2,
                    scale: scale
                };
            }

            update() {
                this.rotation.x += (this.targetRotation.x - this.rotation.x) * 0.1;
                this.rotation.y += (this.targetRotation.y - this.rotation.y) * 0.1;
            }

            draw() {
                const sortedPoints = this.points.map(p => {
                    let rotated = this.rotateY(p, this.rotation.y);
                    rotated = this.rotateX(rotated, this.rotation.x);
                    const projected = this.project(rotated);
                    return {
                        ...p,
                        ...projected,
                        depth: rotated.z
                    };
                }).sort((a, b) => b.depth - a.depth);

                sortedPoints.forEach(p => {
                    const size = p.size * p.scale;
                    
                    if (p.glow) {
                        const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, size * 3.5);
                        gradient.addColorStop(0, p.color);
                        gradient.addColorStop(0.4, p.color.replace('1)', '0.5)'));
                        gradient.addColorStop(1, p.color.replace('1)', '0)'));
                        
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, size * 3.5, 0, Math.PI * 2);
                        ctx.fillStyle = gradient;
                        ctx.fill();
                    }
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, size, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(p.x - size * 0.3, p.y - size * 0.3, size * 0.35, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                    ctx.fill();
                });
            }
        }

        const particles = Array.from({ length: 250 }, () => new Particle());
        const tree = new ChristmasTree();

        let isDragging = false;
        let lastX = 0;
        let lastY = 0;
        let lastDistance = 0;

        // é¼ æ ‡äº‹ä»¶
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
            unlockAudio(); // æ‹–åŠ¨æ—¶ä¹Ÿè§£é”éŸ³é¢‘
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const deltaX = e.clientX - lastX;
                const deltaY = e.clientY - lastY;
                
                tree.targetRotation.y += deltaX * 0.008;
                tree.targetRotation.x += deltaY * 0.008;
                
                lastX = e.clientX;
                lastY = e.clientY;
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            tree.scale += e.deltaY * -0.08;
            tree.scale = Math.max(50, Math.min(400, tree.scale));
            unlockAudio(); // ç¼©æ”¾æ—¶ä¹Ÿè§£é”éŸ³é¢‘
        }, { passive: false });

        // è§¦æ‘¸äº‹ä»¶
        canvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                isDragging = true;
                lastX = e.touches[0].clientX;
                lastY = e.touches[0].clientY;
                unlockAudio(); // è§¦æ‘¸æ—¶è§£é”éŸ³é¢‘
            } else if (e.touches.length === 2) {
                isDragging = false;
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                lastDistance = Math.sqrt(dx * dx + dy * dy);
                unlockAudio(); // è§¦æ‘¸æ—¶è§£é”éŸ³é¢‘
            }
        }, { passive: true });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            
            if (e.touches.length === 1 && isDragging) {
                const deltaX = e.touches[0].clientX - lastX;
                const deltaY = e.touches[0].clientY - lastY;
                
                tree.targetRotation.y += deltaX * 0.008;
                tree.targetRotation.x += deltaY * 0.008;
                
                lastX = e.touches[0].clientX;
                lastY = e.touches[0].clientY;
            } else if (e.touches.length === 2) {
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                const delta = distance - lastDistance;
                tree.scale += delta * 0.5;
                tree.scale = Math.max(50, Math.min(400, tree.scale));
                
                lastDistance = distance;
            }
        }, { passive: false });

        canvas.addEventListener('touchend', () => {
            isDragging = false;
        }, { passive: true });

        function animate() {
            ctx.fillStyle = 'rgba(10, 14, 39, 0.25)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });

            tree.update();
            tree.draw();

            requestAnimationFrame(animate);
        }

        setInterval(() => {
            if (!isDragging) {
                tree.targetRotation.y += 0.008;
            }
        }, 50);

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            tree.scale = Math.min(window.innerWidth, window.innerHeight) * 0.35;
        });

        animate();
    </script>
</body>
</html>